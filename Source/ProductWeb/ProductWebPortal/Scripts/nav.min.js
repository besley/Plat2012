(function(){
/*!
  nav.js v0.1 - (c) Microsoft Corporation
  */
var i,n=function(n,t){return function(){return n.apply(t,arguments)}},t=Object.prototype.hasOwnProperty;i=function(n){var t;return t=n,function(){return arguments.length>0&&(t=arguments[0]),t}},window.NavHistory=function(){function r(t){this.navigateAll=n(this.navigateAll,this),this.navigate=n(this.navigate,this),this._entriesArray=n(this._entriesArray,this),this.forward=n(this.forward,this),this.back=n(this.back,this),this.loadedData=n(this.loadedData,this),this.params=n(this.params,this),this.current=n(this.current,this),this.relative=n(this.relative,this),this.length=n(this.length,this);var r;this.options=t||{},this.options.params=this._extend({},this.options.params,this._asString),this.isLinkedToUrl=!1,r="ko"in this.options?this.options.ko:(typeof ko!="undefined"&&ko!==null?ko.observable:void 0)!=null,this.position=r?ko.observable(-1):i(-1),this.entries=r?ko.observableArray([]):[]}return r.prototype.length=function(){return this._entriesArray().length},r.prototype.relative=function(n){return this._entriesArray()[this.position()+n]||{}},r.prototype.current=function(){return this.relative(0)},r.prototype.params=function(){return this.current().params||{}},r.prototype.loadedData=function(){return this.current().loadedData},r.prototype.back=function(){if(this.position()>0)return this.navigateAll(this.relative(-1).params)},r.prototype.forward=function(){if(this.position()<this.length()-1)return this.navigateAll(this.relative(1).params)},r.prototype._entriesArray=function(){return typeof this.entries=="function"?this.entries():this.entries},r.prototype.initialize=function(n){return n!=null?n.linkToUrl:void 0?this._linkToUrl():this.navigateAll((n!=null?n.params:void 0)||{}),this},r.prototype.navigate=function(n,t){var i;return i=this._extend(this._extend({},this.params()),n),this.navigateAll(i,t)},r.prototype.navigateAll=function(n,t){var h,e,o,s,r,f,c,u,a,l,i=this;n=this._normalizeParams(n),e=!1,o=!1,s=!1,u=t!=null?t.transition:void 0,r=null;if(this.length()&&this._propsAreEqual(n,this.params()))if(t!=null?t.force:void 0)s=!0,r=this.current();else return;else this._propsAreEqual(n,(a=this.relative(-1))!=null?a.params:void 0)?(e=!0,u=u||this.current().savedTransition,r=this.relative(-1)):this._propsAreEqual(n,(l=this.relative(1))!=null?l.params:void 0)?(o=!0,r=this.relative(1),u=u||this.current().savedTransition):r={params:n,navEntryId:"navEntry_"+this._getUniqueSequenceValue()};return f={isFirst:this.length()===0,isBack:e,isForward:o,transition:u},h=function(){var u,n;return e?i.position(i.position()-1):o?i.position(i.position()+1):s||(u=i.length()-i.position()-1,i.entries().splice(i.position()+1,u,r),i.options.maxEntries&&i.length()>i.options.maxEntries?i.entries.shift():(i.position(i.position()+1),typeof i.entries.valueHasMutated=="function"&&i.entries.valueHasMutated())),!e&&f.transition&&(i.current().savedTransition=f.transition),i.isLinkedToUrl&&(t!=null?t.updateUrl:void 0)!==!1&&!s&&(n=i._getUpdatedQueryString(i.params()),window.NavHistory.historyProvider.pushState({url:n})),i.options.onNavigate?i.options.onNavigate.call(i,i.current(),f):void 0},this.options.beforeNavigate?(c=this.objectLoadToken={},this.options.beforeNavigate.call(this,r,f,function(n){if(c===i.objectLoadToken)return n!==void 0&&(r.loadedData=n),h()})):h(),this},r.prototype._asString=function(n){return n===null||n===void 0?"":n.toString()},r.prototype._extend=function(n,i,r){var u,f;for(u in i){if(!t.call(i,u))continue;f=i[u],n[u]=r?r(f):f}return n},r.prototype._normalizeParams=function(n){var t;return t=this.options.params||{},this._extend(this._extend({},t),n||{},this._asString)},r.prototype._propsAreEqual=function(n,i){var u,e,r,f;if(!(n&&i))return n===i;for(u in n){if(!t.call(n,u))continue;e=n[u];if(i[u]!==e)return!1}for(r in i){if(!t.call(i,r))continue;f=i[r];if(n[r]!==f)return!1}return!0},r.prototype._parseQueryString=function(n){var f,o,u,i,t,e,r;if(n.indexOf("?")<0)return{};for(o=n.substring(n.lastIndexOf("?")+1),u={},r=o.split("&"),t=0,e=r.length;t<e;t++)f=r[t],i=f.split("="),i.length===2&&(u[i[0]]=decodeURIComponent(i[1]));return u},r.prototype._formatQueryString=function(n){var i,r,u;i="?";for(r in n){if(!t.call(n,r))continue;u=n[r],i!=="?"&&(i+="&"),i+=r+"="+encodeURIComponent(u)}return i},r.prototype._getUpdatedQueryString=function(n){var u,e,i,f,r;u=this._parseQueryString(window.NavHistory.historyProvider.getState().url),r=this.options.params;for(i in r){if(!t.call(r,i))continue;e=r[i],f=n[i],f===e?delete u[i]:u[i]=f}return this._formatQueryString(u)},r.prototype._getUniqueSequenceValue=function(){return r._sequence=r._sequence||0,(r._sequence++).toString()},r.prototype._linkToUrl=function(){var i,n=this;this.isLinkedToUrl=!0,i=function(){var r,u,e,i,f;u={},r=n._parseQueryString(window.NavHistory.historyProvider.getState().url),e=n.options.params||{};for(i in r){if(!t.call(r,i))continue;f=r[i],e.hasOwnProperty(i)&&(u[i]=f)}return n.navigateAll(u,{updateUrl:!1})},i();return window.NavHistory.historyProvider.onStateChange(i)},r}(),window.NavHistory.historyProvider={onStateChange:function(n){return History.Adapter.bind(window,"statechange",n)},pushState:function(n){return History.pushState(null,null,n.url)},getState:function(){return History.getState()},back:function(){return History.back()}},window.NavHistory.showPane=function(n){var r,f,i,e,u;r=document.getElementById(n);if(r){for(u=r.parentNode.childNodes,i=0,e=u.length;i<e;i++)f=u[i],f.nodeType===1&&(f.style.display="none");return r.style.display="block"}}}).call(this)