@{
    Layout = null;
}
<!DOCTYPE HTML>
<html>
<head>
  <title>SlickGrid example 3: Editing</title>

  <link rel="stylesheet" href="http://localhost:8081/SlickGridPortal/slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="http://localhost:8081/SlickGridPortal/css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css"/>
  <link rel="stylesheet" href="http://localhost:8081/SlickGridPortal/examples/examples.css" type="text/css"/>
    
  <style>
    .cell-title {
      font-weight: bold;
    }

    .cell-effort-driven {
      text-align: center;
    }
  </style>
</head>
<body>
<div style="position:relative">
    <div>
        <input type="button" value="添加" onclick="onAddNew()" />
        <input type="button" value="删除" onclick="onDelete()" />
        <input type="button" value="保存" onclick="onSave()" />
        <input type="button" value="查询" onclick="onQuery()" />
    </div>
  <div style="width:900px;">
    <div id="myGrid" style="width:100%;height:500px;"></div>
  </div>
</div>

<script src="http://localhost:8081/SlickGridPortal/lib/ajaxHelper.js"></script>

<script src="http://localhost:8081/SlickGridPortal/lib/firebugx.js"></script>

<script src="http://localhost:8081/SlickGridPortal/lib/jquery-1.7.min.js"></script>
<script src="http://localhost:8081/SlickGridPortal/lib/jquery-ui-1.8.16.custom.min.js"></script>
<script src="http://localhost:8081/SlickGridPortal/lib/jquery.event.drag-2.0.min.js"></script>

<script src="http://localhost:8081/SlickGridPortal/slick.core.js"></script>
<script src="http://localhost:8081/SlickGridPortal/plugins/slick.checkboxselectcolumn.js"></script>
<script src="http://localhost:8081/SlickGridPortal/plugins/slick.cellrangedecorator.js"></script>
<script src="http://localhost:8081/SlickGridPortal/plugins/slick.cellrangeselector.js"></script>
<script src="http://localhost:8081/SlickGridPortal/plugins/slick.cellselectionmodel.js"></script>
<script src="http://localhost:8081/SlickGridPortal/slick.formatters.js"></script>
<script src="http://localhost:8081/SlickGridPortal/slick.editors.js"></script>
<script src="http://localhost:8081/SlickGridPortal/slick.grid.js"></script>
<script src="http://localhost:8081/SlickGridPortal/plugins/slick.autotooltips.js"></script>
<script src="http://localhost:8081/SlickGridPortal/plugins/slick.cellcopymanager.js"></script>
<script src="http://localhost:8081/SlickGridPortal/plugins/slick.rowselectionmodel.js"></script>

<script src="~/Scripts/json2.js"></script>

<script>
    function requiredFieldValidator(value) {
        if (value == null || value == undefined || !value.length) {
            return { valid: false, msg: "This is a required field" };
        } else {
            return { valid: true, msg: null };
        }
    }

    var grid;
    var data = [];
    var columns = [
      { id: "id", name: "订单编号", field: "ID", width: 50, cssClass: "cell-title" },
      { id: "ProductName", name: "产品名称", field: "ProductName", width: 60 },
      { id: "BuyAmount", name: "购买数量", field: "BuyAmount", editor: Slick.Editors.Text },
      { id: "%", name: "% 折扣率", field: "DiscountPercentage", width: 80, resizable: false, formatter: Slick.Formatters.PercentCompleteBar, editor: Slick.Editors.PercentComplete },
      { id: "BuyDate", name: "购买日期", field: "BuyDate", minWidth: 60, editor: Slick.Editors.Date },
      { id: "BuyPerson", name: "购买人", field: "BuyPerson", editor: Slick.Editors.Text },
      //{ id: "IsArrivaled", name: "是否到货", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "IsArrivaled", formatter: Slick.Formatters.Checkmark, editor: Slick.Editors.Checkbox },
      { id: "IsArrivaled", name: "是否到货", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "IsArrivaled", editor: Slick.Editors.SelectCell },
      { id: "ArrivaledDate", name: "到货日期", field: "ArrivaledDate", minWidth: 60, editor: Slick.Editors.Date },
      { id: "Notes", name: "备注", field: "Notes", width: 120, editor: Slick.Editors.LongText }
    ];

    var options = {
        editable: true,
        //enableAddRow: true,
        enableCellNavigation: true,
        asyncEditorLoading: false,
        autoEdit: false
    };

    var changedItems = [];
    $.getJSON("/ProductSys.WebAPI/api/OrderView", function (data){
        grid = new Slick.Grid("#myGrid", data, columns, options);

        grid.setSelectionModel(new Slick.CellSelectionModel());

        grid.onAddNewRow.subscribe(function (e, args) {
            var item = args.item;
            grid.invalidateRow(data.length);
            data.push(item);
            grid.updateRowCount();
            grid.render();
        });

        grid.onCellChange.subscribe(function (e, args) {
            var item = args.item;
            changedItems.push(item);
        });
    })

    function clearChangedItems() {
        changedItems = [];
    }

    function onAddNew() {
        grid.options.enableAddRow = true;
    }

    function onDelete() {
        var jsonOrder = JSON.stringify(deletedData);
        doJsonDelete('ProductSys.WebAPI/api/OrderView',
            jsonOrder, function (data) {
                alert(data);
            });
    }

    function onSave() {
        var jsonOrder = JSON.stringify(changedItems);
        doJsonUpdate('/ProductSys.WebAPI/api/OrderView',
            jsonOrder, function (data) {
                alert(data);
            });
        clearChangedItems();
        
    }

    function onQuery() {

    }
</script>
</body>
</html>
